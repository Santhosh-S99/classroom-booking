<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formspree Debug Tool - Classroom Booking System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .debug-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            background: #f8f9fa;
        }
        
        .section h3 {
            color: #ff6b35;
            margin-bottom: 15px;
        }
        
        .test-result {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }
        
        .success { 
            background: #d4edda; 
            border-left-color: #28a745; 
            color: #155724; 
        }
        
        .error { 
            background: #f8d7da; 
            border-left-color: #dc3545; 
            color: #721c24; 
        }
        
        .warning { 
            background: #fff3cd; 
            border-left-color: #ffc107; 
            color: #856404; 
        }
        
        .info { 
            background: #d1ecf1; 
            border-left-color: #17a2b8; 
            color: #0c5460; 
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        .button {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }
        
        .button.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .button.info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        
        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .config-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .step-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #ff6b35;
        }
        
        .step-number {
            background: #ff6b35;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .highlight {
            background: yellow;
            color: black;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="debug-container">
        <div class="header">
            <h1><i class="fas fa-bug"></i> Formspree Debug Tool</h1>
            <p>Diagnose and fix Formspree integration issues</p>
        </div>

        <!-- Current Configuration Check -->
        <div class="section">
            <h3><i class="fas fa-cog"></i> Configuration Status</h3>
            <div id="configStatus">
                <div class="test-result info">
                    <strong>Checking Formspree configuration...</strong>
                </div>
            </div>
            <button class="button" onclick="checkConfiguration()">
                <i class="fas fa-search"></i> Check Configuration
            </button>
            <div id="configDetails" style="display: none;"></div>
        </div>

        <!-- Formspree Setup Verification -->
        <div class="section">
            <h3><i class="fas fa-clipboard-check"></i> Setup Verification</h3>
            
            <div class="step-item">
                <div class="step-number">1</div>
                <div>
                    <strong>Formspree Account Status:</strong>
                    <p>Verify your Formspree account is set up correctly</p>
                    <button class="button info" onclick="window.open('https://formspree.io/forms', '_blank')">
                        <i class="fas fa-external-link-alt"></i> Open Formspree Dashboard
                    </button>
                </div>
            </div>
            
            <div class="step-item">
                <div class="step-number">2</div>
                <div>
                    <strong>Form Creation Check:</strong>
                    <p>Make sure you have a form created and got the correct form ID</p>
                    <div class="test-result info">
                        <strong>Expected format:</strong> Your form URL should look like:<br>
                        <code>https://formspree.io/f/<span class="highlight">xvgpkjqw</span></code><br>
                        The highlighted part is your Form ID
                    </div>
                </div>
            </div>

            <div class="step-item">
                <div class="step-number">3</div>
                <div>
                    <strong>Email Settings Check:</strong>
                    <p>Verify your form settings in Formspree dashboard</p>
                    <ul>
                        <li>✅ Email notifications enabled</li>
                        <li>✅ Correct notification email set</li>
                        <li>✅ Form is not in test mode</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Direct Formspree Test -->
        <div class="section">
            <h3><i class="fas fa-paper-plane"></i> Direct Formspree Test</h3>
            <p>Test your Formspree configuration directly (bypass your system)</p>
            
            <div class="form-group">
                <label for="testFormID">Your Formspree Form ID:</label>
                <input type="text" id="testFormID" placeholder="e.g., xvgpkjqw" maxlength="10">
                <small>Enter only the ID part, not the full URL</small>
            </div>
            
            <div class="form-group">
                <label for="testToEmail">Send Test To:</label>
                <input type="email" id="testToEmail" placeholder="your-email@gmail.com">
            </div>
            
            <div class="form-group">
                <label for="testMessage">Test Message:</label>
                <textarea id="testMessage" rows="4" placeholder="Test message content">This is a test email from the Classroom Booking System debug tool. If you receive this, Formspree is working correctly!</textarea>
            </div>
            
            <button class="button success" onclick="testFormspreeDirectly()">
                <i class="fas fa-rocket"></i> Send Direct Test
            </button>
            
            <div id="directTestResult"></div>
        </div>

        <!-- System Integration Test -->
        <div class="section">
            <h3><i class="fas fa-cogs"></i> System Integration Test</h3>
            <p>Test if your booking system's Formspree integration is working</p>
            
            <button class="button" onclick="testSystemIntegration()">
                <i class="fas fa-link"></i> Test System Integration
            </button>
            
            <div id="systemTestResult"></div>
        </div>

        <!-- Common Issues & Solutions -->
        <div class="section">
            <h3><i class="fas fa-wrench"></i> Common Issues & Quick Fixes</h3>
            
            <div class="test-result warning">
                <strong>Issue 1: Wrong Form ID Format</strong>
                <p><strong>Problem:</strong> Using full URL instead of just the ID</p>
                <p><strong>Solution:</strong> Use only the ID part (e.g., "xvgpkjqw") not the full URL</p>
            </div>
            
            <div class="test-result warning">
                <strong>Issue 2: CORS Errors</strong>
                <p><strong>Problem:</strong> Browser blocking cross-origin requests</p>
                <p><strong>Solution:</strong> Make sure you're accessing via HTTPS (GitHub Pages should provide this)</p>
            </div>
            
            <div class="test-result warning">
                <strong>Issue 3: Email Not Received</strong>
                <p><strong>Problem:</strong> Formspree working but emails not arriving</p>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Check spam folder</li>
                    <li>Verify email settings in Formspree dashboard</li>
                    <li>Make sure notification email is correct</li>
                </ul>
            </div>
            
            <div class="test-result warning">
                <strong>Issue 4: Form Not Configured</strong>
                <p><strong>Problem:</strong> Form ID not updated in config file</p>
                <p><strong>Solution:</strong> Update the formspreeEndpoint in your firebase-config.js</p>
            </div>
        </div>

        <!-- Configuration Generator -->
        <div class="section">
            <h3><i class="fas fa-code"></i> Configuration Generator</h3>
            <p>Generate the correct configuration for your system</p>
            
            <div class="form-group">
                <label for="configFormID">Your Formspree Form ID:</label>
                <input type="text" id="configFormID" placeholder="e.g., xvgpkjqw">
            </div>
            
            <div class="form-group">
                <label for="configFromEmail">Your Email Address:</label>
                <input type="email" id="configFromEmail" value="santhoshstr385@gmail.com">
            </div>
            
            <button class="button info" onclick="generateConfiguration()">
                <i class="fas fa-file-code"></i> Generate Config
            </button>
            
            <div id="generatedConfig"></div>
        </div>

        <!-- Console Output -->
        <div class="section">
            <h3><i class="fas fa-terminal"></i> Debug Console</h3>
            <div id="debugConsole" class="console-output">
                Formspree debug tool initialized...\n
            </div>
            <button class="button" onclick="clearConsole()">
                <i class="fas fa-trash"></i> Clear Console
            </button>
            <button class="button info" onclick="exportDebugLog()">
                <i class="fas fa-download"></i> Export Debug Log
            </button>
        </div>
    </div>

    <script>
        let debugLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            debugLog.push(logEntry);
            
            const console = document.getElementById('debugConsole');
            console.textContent += logEntry + '\n';
            console.scrollTop = console.scrollHeight;
        }

        function showResult(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}" style="margin-top: 15px;">${message}</div>`;
        }

        function checkConfiguration() {
            log('Checking current configuration...');
            
            const configStatus = document.getElementById('configStatus');
            const configDetails = document.getElementById('configDetails');
            
            // Try to access the configuration from the main system
            try {
                // Check if firebase-config is loaded
                if (typeof emailConfig === 'undefined') {
                    configStatus.innerHTML = `
                        <div class="test-result error">
                            <strong>❌ Configuration Not Found</strong><br>
                            The emailConfig object is not loaded. Make sure you've updated firebase-config.js with the Formspree version.
                        </div>
                    `;
                    log('Formspree configuration not found', 'error');
                    return;
                }

                // Display current configuration
                const config = {
                    formspreeEndpoint: emailConfig.formspreeEndpoint || 'NOT SET',
                    fromEmail: emailConfig.fromEmail || 'NOT SET',
                    maxRetries: emailConfig.maxRetries || 'NOT SET',
                    configured: emailConfig.formspreeEndpoint && emailConfig.formspreeEndpoint !== 'YOUR_FORMSPREE_FORM_ID'
                };

                configDetails.innerHTML = `
                    <div class="config-display">
                        <strong>Current Configuration:</strong><br>
                        formspreeEndpoint: "${config.formspreeEndpoint}"<br>
                        fromEmail: "${config.fromEmail}"<br>
                        maxRetries: ${config.maxRetries}<br>
                        configured: ${config.configured}
                    </div>
                `;
                configDetails.style.display = 'block';

                if (config.configured) {
                    configStatus.innerHTML = `
                        <div class="test-result success">
                            <strong>✅ Configuration Found</strong><br>
                            Formspree is configured with endpoint: ${config.formspreeEndpoint}
                        </div>
                    `;
                    log('Formspree configuration is valid');
                } else {
                    configStatus.innerHTML = `
                        <div class="test-result warning">
                            <strong>⚠️ Configuration Incomplete</strong><br>
                            Form ID not set. Please update the formspreeEndpoint in your config.
                        </div>
                    `;
                    log('Formspree configuration incomplete', 'warning');
                }

            } catch (error) {
                configStatus.innerHTML = `
                    <div class="test-result error">
                        <strong>❌ Configuration Error</strong><br>
                        ${error.message}
                    </div>
                `;
                log(`Configuration check failed: ${error.message}`, 'error');
            }
        }

        async function testFormspreeDirectly() {
            const formID = document.getElementById('testFormID').value.trim();
            const toEmail = document.getElementById('testToEmail').value.trim();
            const message = document.getElementById('testMessage').value.trim();

            if (!formID || !toEmail || !message) {
                showResult('directTestResult', 'error', '❌ Please fill in all fields');
                log('Direct test failed: missing fields', 'error');
                return;
            }

            log(`Testing Formspree directly with form ID: ${formID}`);
            showResult('directTestResult', 'info', 'Sending test email...');

            try {
                const formspreeUrl = `https://formspree.io/f/${formID}`;
                
                const response = await fetch(formspreeUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        _replyto: toEmail,
                        _subject: '🧪 Direct Formspree Test - Classroom Booking System',
                        email: toEmail,
                        name: 'Debug Tool Test',
                        message: message,
                        test: true
                    })
                });

                const responseData = await response.json();

                if (response.ok) {
                    showResult('directTestResult', 'success', `✅ Direct test successful! Check ${toEmail} for the email.`);
                    log('Direct Formspree test successful');
                    log(`Response: ${JSON.stringify(responseData)}`);
                } else {
                    throw new Error(`HTTP ${response.status}: ${responseData.error || response.statusText}`);
                }

            } catch (error) {
                showResult('directTestResult', 'error', `❌ Direct test failed: ${error.message}`);
                log(`Direct Formspree test failed: ${error.message}`, 'error');
                
                if (error.message.includes('404')) {
                    showResult('directTestResult', 'warning', `
                        ❌ Form not found. Please check:<br>
                        • Form ID is correct<br>
                        • Form exists in your Formspree account<br>
                        • Form is published (not in draft mode)
                    `);
                } else if (error.message.includes('CORS')) {
                    showResult('directTestResult', 'warning', `
                        ❌ CORS issue detected:<br>
                        • Make sure you're accessing via HTTPS<br>
                        • Check your form settings in Formspree
                    `);
                }
            }
        }

        async function testSystemIntegration() {
            log('Testing system integration...');
            
            showResult('systemTestResult', 'info', 'Testing system integration...');
            
            try {
                // Check if the system function exists
                if (typeof window.testFormspreeConfiguration === 'undefined') {
                    throw new Error('System integration function not found. Make sure you\'re using the updated firebase-config.js file.');
                }

                const result = await window.testFormspreeConfiguration();
                
                if (result.success) {
                    showResult('systemTestResult', 'success', `✅ System integration test successful! Check your email for the test message.`);
                    log('System integration test successful');
                } else {
                    showResult('systemTestResult', 'error', `❌ System integration failed: ${result.error}`);
                    log(`System integration test failed: ${result.error}`, 'error');
                }

            } catch (error) {
                showResult('systemTestResult', 'error', `❌ System integration test failed: ${error.message}`);
                log(`System integration test failed: ${error.message}`, 'error');
                
                if (error.message.includes('not found')) {
                    showResult('systemTestResult', 'warning', `
                        ⚠️ Integration function not found:<br>
                        • Make sure you've replaced firebase-config.js with the Formspree version<br>
                        • Reload the page after updating the file<br>
                        • Check browser console for loading errors
                    `);
                }
            }
        }

        function generateConfiguration() {
            const formID = document.getElementById('configFormID').value.trim();
            const fromEmail = document.getElementById('configFromEmail').value.trim();
            
            if (!formID || !fromEmail) {
                showResult('generatedConfig', 'error', '❌ Please fill in both fields');
                return;
            }

            const configCode = `
// Formspree Configuration for firebase-config.js
const emailConfig = {
    formspreeEndpoint: "${formID}",
    fromEmail: "${fromEmail}",
    maxRetries: 3,
    retryDelay: 2000
};
            `.trim();

            document.getElementById('generatedConfig').innerHTML = `
                <div class="test-result success">
                    <strong>✅ Configuration Generated</strong><br>
                    Copy this into your firebase-config.js file:
                </div>
                <div class="code-block">${configCode}</div>
                <button class="button info" onclick="copyConfiguration()">
                    <i class="fas fa-copy"></i> Copy Configuration
                </button>
            `;
            
            // Store for copying
            window.generatedConfigCode = configCode;
            log(`Generated configuration for form ID: ${formID}`);
        }

        function copyConfiguration() {
            if (window.generatedConfigCode) {
                navigator.clipboard.writeText(window.generatedConfigCode).then(() => {
                    alert('Configuration copied to clipboard!');
                    log('Configuration copied to clipboard');
                }).catch(err => {
                    alert('Failed to copy. Please copy manually from the code block above.');
                    log('Failed to copy configuration', 'error');
                });
            }
        }

        function clearConsole() {
            document.getElementById('debugConsole').textContent = 'Console cleared.\n';
            debugLog = [];
        }

        function exportDebugLog() {
            const logContent = debugLog.join('\n');
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `formspree-debug-log-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('Debug log exported');
        }

        // Auto-run configuration check when page loads
        window.addEventListener('load', () => {
            log('Formspree debug tool loaded');
            
            // Try to load the firebase config
            const script = document.createElement('script');
            script.src = 'firebase-config.js';
            script.onload = () => {
                log('Firebase configuration loaded successfully');
                setTimeout(checkConfiguration, 1000);
            };
            script.onerror = () => {
                log('Failed to load firebase-config.js', 'error');
                document.getElementById('configStatus').innerHTML = `
                    <div class="test-result error">
                        <strong>❌ Cannot Load Configuration</strong><br>
                        Make sure firebase-config.js exists and is accessible.
                    </div>
                `;
            };
            document.head.appendChild(script);
        });
    </script>
</body>
</html>